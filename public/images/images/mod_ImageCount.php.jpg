<?php
defined('_frutel_new') or die('Direkter Aufruf Verboten.');
require "inc/intern_safety.php";
class ImageCount extends Admin
{
    var $cfg;
    var $dom;
function ImageCount()
{


    global $cfg;
    $this->cfg = $cfg;
    include "modules/mod_Support.php";
    $this->dom = $_SESSION['ge'];
       echo "<pre>";
}
function GetFromDB($dom='')
{
    $this->GetTables();
// var_dump($this->tables);
   $this->maintable = "tables_node";
    foreach($this->tables as $tk => $table)
    {
        $this->to_index[] = $table['name'];




    }
}
function Start()
{
    $this->GetFromDB($_SESSION['ge']);
    $this->ParseTables($this->to_index);
}
function ParseTables($tables)
{
    foreach($tables as $val)
    {
        $this->GetFields($val);

        foreach($this->fieldname[$val] as $kk => $vv)
        {
            if(substr_count_alt($vv,"img_") && $vv != "xkis_def_img_set")
            {
                $this->ximg[$val][] = $vv;
            }
            if(substr_count_alt($vv,"imgcomp_"))
            {
                $this->ximgcomp[$val][] = $vv;
            }
            if(substr_count_alt($vv,"file_"))
            {
                $this->xfile[$val][] = $vv;
            }
            if(substr_count_alt($vv,"imgdir_"))
            {
                $this->ximgdir[$val][] = $vv;
            }
            if(substr_count_alt($vv,"files_"))
            {
                $this->xfiles[$val][] = $vv;
            }
        }
    }
   $this->Elector();

}
function Elector()
{

    foreach($this->ximg as $key=>$val)
    {
        foreach($val as $kk=>$vv)
        {
            $this->ElectImg($vv,$key);
        }
    }
    foreach($this->ximgcomp as $ickey=>$icval)
    {
        foreach($icval as $ickk=>$icvv)
        {
            $this->ElectImg($icvv,$ickey);
        }
    }
    foreach($this->xfile as $key=>$val)
    {
        foreach($val as $kk=>$vv)
        {
            $this->ElectImg($vv,$key);
        }
    }
}
function ElectImg($cname,$tname)
{
    $this->db->DoSql("SELECT $cname AS img FROM ".$this->tpref."$tname");
    while($row = $this->db->GetRes())
    {
        $this->images[$tname][$cname] = $row['img'];
    }
    $this->GetFromPath($cname,$tname,$this->images);

}
function GetFromPath($column,$table,$imarr=array())
{
    global $path;
    include "inc/cfg.autocfg.php";
    $impath = "_".$this->dom."/".@$path[$table][$column];
    foreach($imarr as $key=>$value)
    {
/*        var_dump($path);*/
        if(!@is_file($impath.$value[$table][$column]) && !@empty($value[$table][$column]) && @substr_count_alt($value[$table][$column],"."))
        {
            $not_found[$table][$column][] = $value;
        }
    }
    @var_dump($not_found);
}
// endclass

}

?>
